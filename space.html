<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Space!</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <style>
        circle {
            fill: #000;
            pointer-events: none;
        }
    </style>
</head>
<body>
<div style="margin: 0 auto; width: 960px">
<div>
    <input id="id-search" type="text">
</div>
    <br>
<div id="space"></div>
</div>
</body>
<script type="text/javascript">
    var width = 960,
            height = 600;
    var minZoom = 0.001;
    var maxZoom = 1;
    function thing(id, x, y, r) {
        return {
            id: id,
            x: x,
            y: y,
            r: r
        }
    }
    var things = [];
    function randomCentered() {
        return Math.random() - 0.5;
    }
    function randomClusterX() {
        return randomCentered() * width / minZoom;
    }
    function randomClusterY() {
        return randomCentered() * height / minZoom;
    }
    function randomClusterSize() {
        return Math.floor(Math.random() * 12) + 5;
    }
    function randomClusterOffset(p, starR) {
        var ra = Math.random() * 2 * Math.PI;
        var rr = Math.random() * 1000 + starR + 10;
        var rx = Math.cos(ra) * rr;
        var ry = Math.sin(ra) * rr;
        return [p[0] + rx, p[1] + ry];
    }
    function randomStarR() {
        return Math.pow(10, 1 + Math.random() * 2);
    }
    function randomR() {
        return 10;//Math.random() * 10;
    }
    var id = 1;
    for (var cluster = 0; cluster < 50; cluster++) {
        var clusterSize = randomClusterSize();
        var clusterX = randomClusterX();
        var clusterY = randomClusterY();
        var starR = randomStarR();
        things.push(thing(id++, clusterX, clusterY, starR));
        for (var i = 0; i < clusterSize; i++) {
            var position = randomClusterOffset([clusterX, clusterY], starR);
            things.push(thing(id++,
                    position[0],
                    position[1],
                    randomR()))
        }
    }
    console.log(things);
    var svg = d3.select("div#space")
            .style("width", (width + 2) + "px")
            .style("height", (height + 2) + "px")
//            .style("margin", "0 auto")
            .append("svg")
            .attr("width", width)
            .attr("height", height)
            .style("border", "solid #000 1px");
    var center = svg.append("g")
//            .attr("transform", "translate(" + [width/2, height/2] + ")")
            ;
    var zoom = d3.behavior.zoom()
            .scale(minZoom)
            .scaleExtent([minZoom, maxZoom])
            .translate([width / 2, height / 2])
            .size(width, height)
            .on("zoom", zoomed);
    var camera = center.append("g")
            .attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
    camera.selectAll("circle.thing")
            .data(things)
            .enter()
            .append("circle")
            .attr("class", "thing")
            .attr("transform", function (t) {
                return "translate(" + [t.x, t.y] + ")"
            })
            .attr("r", function (t) {
                return t.r;
            });
    function zoomed() {
        camera.attr("transform", "translate(" + zoom.translate() + ")scale(" + zoom.scale() + ")");
    }
    d3.select("body").on("keydown", function () {
        zoom.scale(minZoom)
                .translate([width / 2, height / 2]);
        zoomed();
    });
    svg.call(zoom);
</script>
</html>

